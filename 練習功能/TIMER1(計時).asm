list p=18f4520
#include <p18f4520.inc>
CONFIG OSC=HS, PWRT=ON, WDT=OFF, LVP=OFF, PBADEN=OFF

VAL_TMR1 equ .16384

org 0x00
GOTO INITIAL

org 0x08
  BCF PIR1,TMR1IF
  GOTO INT
  RETFIE

org 0x40
INITIAL:
  CALL INITIAL_2
  CALL INITIAL_TMR1
  GOTO MAIN 

MAIN:
  GOTO MAIN

INT:
  MOVLW (.65536-VAL_TMR1)/.256
  MOVWF TMR1H
  MOVLW (.65536-VAL_TMR1)%.256
  MOVWF TMR1L
  INCF PORTD
  RETFIE FAST
  
INITIAL_2:
  CLRF TRISD
  CLRF PORTD
  RETURN
INITIAL_TMR1:
  MOVLW B'10001111'
  MOVWF T1CON
  MOVLW (.65536-VAL_TMR1)/.256
  MOVWF TMR1H
  MOVLW (.65536-VAL_TMR1)%.256
  MOVWF TMR1L
  BSF RCON,IPEN
  BSF INTCON,GIEH
  BSF IPR1,TMR1IP
  BCF PIR1,TMR1IF
  BSF PIE1,TMR1IE
  RETURN
END

